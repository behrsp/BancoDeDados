SELECT 

    'SD1' AS ALIAS,
    D1.D1_COD AS PRODUTO,
    B1.B1_DESC AS DESCRICAO,
    D1.D1_DOC AS NOTA,
    D1.D1_DTDIGIT AS DIGITACAO,
    D1.D1_QUANT * IIF(D1.D1_TIPO IN('B','D'), -1,1)AS QUANTIDADE -- NA ENTRADA SE FOR DEVOLUCAO É POSITIVO SE NAO É NEGATIVO

FROM 
    SD1010 D1
    INNER JOIN SB1010 B1 ON(
        B1.B1_FILIAL = '09ALFA'
        AND B1.B1_COD = D1.D1_COD
        AND B1.D_E_L_E_T_=''
    )
WHERE D1.D1_FILIAL = '09ALFA01'
    AND D1.D1_DTDIGIT >= '20250101'
    AND D1.D1_DTDIGIT <=  '20253003'
    AND D1.D_E_L_E_T_=''

UNION ALL

SELECT 

    'SD2' AS ALIAS,
    D2.D2_COD AS PRODUTO,
    B1.B1_DESC AS DESCRICAO,
    D2.D2_DOC AS NOTA,
    D2.D2_EMISSAO AS DIGITACAO,
    D2.D2_QUANT * IIF(D2.D2_TIPO IN('B','D'), -1,1)AS QUANTIDADE -- NA SAIDA SE FOR DEVOLUCAO É POSITIVO SE NAO É NEGATIVO

FROM 
    SD2010 D2
    INNER JOIN SB1010 B1 ON(
        B1.B1_FILIAL = '09ALFA'
        AND B1.B1_COD = D2.D2_COD
        AND B1.D_E_L_E_T_=''
    )
WHERE D2.D2_FILIAL = '09ALFA01'
    AND D2.D2_EMISSAO >= '20250101'
    AND D2.D2_EMISSAO <=  '20253003'
    AND D2.D_E_L_E_T_=''

    UNION ALL

SELECT 

    'SD3' AS ALIAS,
    D3.D3_COD AS PRODUTO,
    B1.B1_DESC AS DESCRICAO,
    D3.D3_DOC AS NOTA,
    D3.D3_EMISSAO AS DIGITACAO,
    D3.D3_QUANT * IIF(LEFT(D3.D3_CF,2) = 'RE', -1,1)AS QUANTIDADE

FROM 
    SD3010 D3
    INNER JOIN SB1010 B1 ON(
        B1.B1_FILIAL = '09ALFA'
        AND B1.B1_COD = D3.D3_COD
        AND B1.D_E_L_E_T_=''
    )
WHERE D3.D3_FILIAL = '09ALFA01'
    AND D3.D3_EMISSAO >= '20250101'
    AND D3.D3_EMISSAO <=  '20253003'
    AND D3.D_E_L_E_T_=''


ORDER BY    
    PRODUTO,
    DIGITACAO

